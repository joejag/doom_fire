<!DOCTYPE html>
<html>

<body>

  <p>Inspiration <a href="https://fabiensanglard.net/doom_fire_psx/">Doom fire</a></p>

  <canvas id="fire" width="800" height="400" />

  <script>
    var c = document.getElementById("fire")
    var ctx = document.getElementById("fire").getContext("2d")

    var GRID_HEIGHT = 100
    var GRID_WIDTH = 200
    var CELL_SIZE = 5

    var colours = {
      0: '#000000', 1: '#070707', 2: '#1f0707', 3: '#2f0f07', 4: '#470f07', 5: '#571707', 6: '#671f07', 7: '#771f07',
      8: '#8f2707', 9: '#9f2f07', 10: '#af3f07', 11: '#bf4707', 12: '#c74707', 13: '#DF4F07', 14: '#DF5707', 15: '#DF5707',
      16: '#D75F07', 17: '#D7670F', 18: '#cf6f0f', 19: '#cf770f', 20: '#cf7f0f', 21: '#CF8717', 22: '#C78717', 23: '#C78F17',
      24: '#C7971F', 25: '#BF9F1F', 26: '#BF9F1F', 27: '#BFA727', 28: '#BFA727', 29: '#BFAF2F', 30: '#B7AF2F', 31: '#B7B72F',
      32: '#B7B737', 33: '#CFCF6F', 34: '#DFDF9F', 35: '#EFEFC7', 36: '#FFFFFF'
    }

    var firePixels = Array(GRID_HEIGHT).fill([])
    firePixels[0] = Array(GRID_WIDTH).fill(36)
    for (y = 1; y < GRID_HEIGHT; y++) {
      firePixels[y] = Array(GRID_WIDTH).fill(0)
    }

    function spreadFire() {
      for (y = 1; y < GRID_HEIGHT; y++) {
        for (x = 0; x < GRID_WIDTH; x++) {
          var randHeatChange = Math.round(Math.random() * 3.0) & 3
          var nextColour = Math.max(0, firePixels[y - 1][x] - (randHeatChange))

          var randX = Math.round(Math.random() * 3.0) & 3
          var crossWindSpeedX = Math.min(GRID_WIDTH - 1, Math.max(0, x - randX + 1))

          var randY = Math.round(Math.random() * 1.0) & 1
          var crossWindSpeedY = Math.min(GRID_HEIGHT - 1, Math.max(0, y + randY))

          firePixels[crossWindSpeedY][crossWindSpeedX] = nextColour
        }
      }
    }

    function draw() {
      for (y = 0; y < GRID_HEIGHT; y++) {
        for (x = 0; x < GRID_WIDTH; x++) {
          ctx.fillStyle = colours[firePixels[y][x]]
          ctx.fillRect(x * CELL_SIZE, c.height - (y * CELL_SIZE), CELL_SIZE, CELL_SIZE)
        }
      }
    }

    setInterval(() => { spreadFire(); draw() }, 100)
    setInterval(() => { firePixels[0] = Array(GRID_WIDTH).fill(0) }, 12000)
    setInterval(() => { firePixels[0] = Array(GRID_WIDTH).fill(36) }, 8000)

  </script>

</body>

</html>